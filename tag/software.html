<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:og="http://ogp.me/ns#"
      xmlns:fb="https://www.facebook.com/2008/fbml">
<head>
    <title>software - The·Grid</title>
    <!-- Using the latest rendering mode for IE -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    

    <!-- Open Graph tags -->
        <meta property="og:site_name" content="The·Grid" />
            <meta property="og:type" content="website"/>
            <meta property="og:title" content="The·Grid"/>
            <meta property="og:url" content="http://www.thegrid.fish"/>
            <meta property="og:description" content="The·Grid"/>

    <!-- Bootstrap -->
        <link rel="stylesheet" href="http://www.thegrid.fish/theme/css/bootstrap.cyborg.min.css" type="text/css"/>
    <link href="http://www.thegrid.fish/theme/css/font-awesome.min.css" rel="stylesheet">

    <link href="http://www.thegrid.fish/theme/css/pygments/native.css" rel="stylesheet">
        <link href="http://www.thegrid.fish/theme/css/typogrify.css" rel="stylesheet">
    <link rel="stylesheet" href="http://www.thegrid.fish/theme/css/style.css" type="text/css"/>
    <link href="http://www.thegrid.fish/bodges.css" rel="stylesheet" />

        <link href="http://www.thegrid.fish/feeds/all.atom.xml" type="application/atom+xml" rel="alternate"
              title="The·Grid ATOM Feed"/>

</head>
<body>

<div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a href="http://www.thegrid.fish/" class="navbar-brand">
The·Grid            </a>
        </div>
        <div class="collapse navbar-collapse navbar-ex1-collapse">
            <ul class="nav navbar-nav">
                         <li><a href="http://www.thegrid.fish/pages/about.html">
                             About
                          </a></li>
                        <li >
                            <a href="http://www.thegrid.fish/category/blog.html">Blog</a>
                        </li>
                <script language="JavaScript" src="/quotes.js"></script>
                <li><p><script language="JavaScript">
                document.write(quote[pickquote])</script></p></li>
            </ul>
            <ul class="nav navbar-nav navbar-right">
                <li><a href="http://www.thegrid.fish/archives.html"><i class="fa fa-th-list"></i><span class="icon-label">Archives</span></a></li>
            </ul>
        </div>
        <!-- /.navbar-collapse -->
    </div>
</div> <!-- /.navbar -->

<div class="container">
    <div class="row">
        <div class="col-sm-9">

            <article>
                <h2><a href="http://www.thegrid.fish/2014/08/09/pattern-editor">Pattern&nbsp;Editor</a></h2>
                <div class="summary"><p>We&#8217;ve been working on a piece of software to make it easy to edit the
non-interactive grid patterns, especially ones we want syncrhonised to music.
That software is now ready for&nbsp;use!</p>
<p><img alt="pattern editor screenshot" src="/images/mpe.png" /></p>
<p>It works by defining frames at any point in time, which can contain any
pattern, and making it as easy as possible to create and edit frames, including
beat synchronisation. It&#8217;s programmed in Python using the Pyglet library and a
handful of&nbsp;OpenGL.</p>
                </div>
            </article>
            <hr/>
            <article>
                <h2><a href="http://www.thegrid.fish/2014/07/30/integration-testing">Integration&nbsp;Testing</a></h2>
                <div class="summary"><p>I got impatient of waiting for the full set of parts to complete the
electronics and put a board together with some components I had lying&nbsp;around.</p>
<p><img alt="Prototype board" src="/images/stuffed_proto.jpg" /></p>
<p>I only had two MOSFETs and was lacking in connectors, but it was enough to
test.  Everything fit beautifully and soldered up&nbsp;well.</p>
<p>Wanting to test things, I connected the board to an <a href="arduino.cc/en/Guide/ArduinoLeonardo">Arduino
Leonardo</a> with some basic test code, and
it worked!  It only took a short while more to write the Leonardo firmware to
accept frames over <span class="caps">USB</span> <span class="caps">CDC</span> and drive the shift registers appropriately.  It
took an even shorter while to write a sink plugin for the control&nbsp;software.</p>
<p><img alt="Full stack test" src="/images/full_stack.jpg" /></p>
<p>That blurry image might not look like much, but it&#8217;s a pretty significant
result.  The prototype <span class="caps">PCB</span> is driving two of our <span class="caps">LED</span> strips, powered by the
rebuilt power supplies.  The board was controlled by the control software via
the Arduino&nbsp;Leonardo.</p>
                </div>
            </article>
            <hr/>
            <article>
                <h2><a href="http://www.thegrid.fish/2014/07/13/testing-intensifies">Testing&nbsp;Intensifies</a></h2>
                <div class="summary"><p>Another busy day. Further software refinements led to a Tkinter-based sink to
make visualisation&nbsp;easier:</p>
<p><img alt="Tkinter GUI" src="/images/tkinter.png" /></p>
<p>I also stuck together a simple sink using pylibftdi in bitbang mode, which was
even easier than I expected. It generates the <span class="caps">DATA</span>, <span class="caps">SRCK</span> and <span class="caps">RCK</span> signals for
the shift registers using three pins on the <span class="caps">FTDI</span>.</p>
<p>Meanwhile David was busy finishing up the <span class="caps">PCB</span> design (more on that later).
Afterwards he stuck together the prototype electronics on a breadboard,
connected up the relays and two (of the eventual 49) <span class="caps">LED</span> strips and we tried
hooking it all up for the first&nbsp;time.</p>
<p><img alt="First Full Test" src="/images/first_full_test.jpg" />
<img alt="Full Test Unrolled" src="/images/full_test_unrolled.jpg" /></p>
<iframe width="420" height="315"
src="//www.youtube-nocookie.com/embed/3Ok0Z6Nax6U?rel=0" frameborder="0"
allowfullscreen></iframe>

<p>It all worked! Additionally the relays sounded great on one of the aluminium
poles. This is a very positive result and we&#8217;re now confident that the
electronics design, software design, and various other choices that led to this
moment were at least on the right track.  All that&#8217;s left is the actual PCBs,
the hard parts of the software (person tracking!) and a million other
tasks-to-do before <span class="caps">EMF</span>.</p>
                </div>
            </article>
            <hr/>
            <article>
                <h2><a href="http://www.thegrid.fish/2014/07/12/control-software">Control&nbsp;Software</a></h2>
                <div class="summary"><p>Last night we started fleshing out the design for the control software. The
bulk of it will be written in Python, because we&#8217;re both familiar with the
language and it has good bindings to libFTDI and&nbsp;OpenCV.</p>
<p>First I sketched out an outline of the overall&nbsp;design:</p>
<p><img alt="paper planning" src="/images/software_plan.jpg" /></p>
<p>We have a central &#8216;Control&#8217; object which is responsible for tying everything
together, and externally we&#8217;ll use <a href="http://supervisord.org/">supervisord</a> to
start and manage it. It starts an <span class="caps">API</span> and Tracking process via multiprocessing,
and loads up all the Patterns and Sinks it knows about and waits for&nbsp;instructions.</p>
<p>The <span class="caps">HTTP</span> <span class="caps">API</span> is in a separate process and uses the wonderful
<a href="http://flask.pocoo.org/">Flask</a> library, with a Queue to pass commands back to
the Control process. The <span class="caps">API</span> receives (command, value) pairs from <span class="caps">HTTP</span> <span class="caps">POST</span>
requests, checks the authentication against the settings, then sends the
command on. Later we&#8217;ll probably extend this to also return data about the
current state of the system, for example which Patterns are&nbsp;available.</p>
<p>The Tracking process will use <a href="http://opencv.org/">OpenCV</a> to detect people in
the grid, estimate the position of their feet in the 2d (top-down) grid via
projective transforms, assign each person a unique number and keep track of
them for as long as they remain in the grid. This is probably going to be one
of the more challenging components to write! It passes this data back to the
Control process and the Patterns via a proxied dict through a multiprocessing
Manager&nbsp;object.</p>
<p>Patterns and Sinks are similar. Both have their own package for all the pattern
or sink files, a top level class to inherit from, and register themselves with
the system using a decorator. For Patterns, the decorator also allows a
configuration to be registered, so that for example the maze pattern can offer
one- ...</p>
                    <a class="btn btn-default btn-xs" href="http://www.thegrid.fish/2014/07/12/control-software">more ...</a>
                </div>
            </article>
            <hr/>

        </div>
        <div class="col-sm-3 well well-sm" id="sidebar">

<aside>
    <section>
        <ul class="list-group list-group-flush">
                <li class="list-group-item"><h4><i class="fa fa-home fa-lg"></i><span class="icon-label">Social</span></h4>
                  <ul class="list-group" id="social">
                    <li class="list-group-item"><a href="https://twitter.com/__thegrid"><i class="fa fa-twitter-square fa-lg"></i> Twitter</a></li>
                  </ul>
                </li>



                <li class="list-group-item"><a href="http://www.thegrid.fish/"><h4><i class="fa fa-tags fa-lg"></i><span class="icon-label">Tags</span></h4></a>
                    <ul class="list-group " id="tags">
                        <li class="list-group-item tag-1">
                            <a href="http://www.thegrid.fish/tag/power.html">
                                power
                            </a>
                        </li>
                        <li class="list-group-item tag-1">
                            <a href="http://www.thegrid.fish/tag/electronics.html">
                                electronics
                            </a>
                        </li>
                        <li class="list-group-item tag-2">
                            <a href="http://www.thegrid.fish/tag/software.html">
                                software
                            </a>
                        </li>
                        <li class="list-group-item tag-2">
                            <a href="http://www.thegrid.fish/tag/leds.html">
                                leds
                            </a>
                        </li>
                        <li class="list-group-item tag-3">
                            <a href="http://www.thegrid.fish/tag/structures.html">
                                structures
                            </a>
                        </li>
                        <li class="list-group-item tag-4">
                            <a href="http://www.thegrid.fish/tag/testing.html">
                                testing
                            </a>
                        </li>
                    </ul>
                </li>    
    <li class="list-group-item"><h4><i class="fa fa-external-link-square fa-lg"></i><span class="icon-label">Links</span></h4>
      <ul class="list-group" id="links">
        <li class="list-group-item">
            <a href="http://emfcamp.org" target="_blank">
                EMF 2014
            </a>
        </li>
      </ul>
    </li>

        </ul>
    </section>

</aside>        </div>
    </div>
</div>
<footer>
   <div class="container">
      <hr>
      <div class="row">
         <div class="col-xs-10">&copy; 2014 Dr House Industries
            &middot; Powered by <a href="https://github.com/DandyDev/pelican-bootstrap3" target="_blank">pelican-bootstrap3</a>,
            <a href="http://docs.getpelican.com/" target="_blank">Pelican</a>,
            <a href="http://getbootstrap.com" target="_blank">Bootstrap</a>         </div>
         <div class="col-xs-2"><p class="pull-right"><i class="fa fa-arrow-up"></i> <a href="#">Back to top</a></p></div>
      </div>
   </div>
</footer>
<script src="http://www.thegrid.fish/theme/js/jquery.min.js"></script>

<!-- Include all compiled plugins (below), or include individual files as needed -->
<script src="http://www.thegrid.fish/theme/js/bootstrap.min.js"></script>

<!-- Enable responsive features in IE8 with Respond.js (https://github.com/scottjehl/Respond) -->
<script src="http://www.thegrid.fish/theme/js/respond.min.js"></script>

</body>
</html>